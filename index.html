<!DOCTYPE html>
<html>
<head>
    <title>Klyppr - Automatic Video Silence Clipper</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="app-wrapper">
        <div class="container">
            <header class="header">
                <div class="logo-container">
                    <svg class="logo-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                    </svg>
                    <h1 class="title">Klyppr</h1>
                </div>
                <p class="subtitle">Automatic Video Silence Clipper</p>
            </header>

            <main class="main-content">
                <section class="file-selection">
                    <div class="form-group">
                        <label class="form-label">
                            <svg class="label-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                            </svg>
                            Input Video
                        </label>
                        <div class="input-group">
                            <input type="text" id="inputPath" readonly placeholder="Select video file..." class="file-input" data-tooltip="Select your input video file">
                            <button class="browse-btn" onclick="selectInput()" data-tooltip="Browse for video">
                                <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"/>
                                </svg>
                                <span class="btn-text">Browse</span>
                            </button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            <svg class="label-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"/>
                            </svg>
                            Output Folder
                        </label>
                        <div class="input-group">
                            <input type="text" id="outputPath" readonly placeholder="Select output folder..." class="file-input" data-tooltip="Select output folder">
                            <button class="browse-btn" onclick="selectOutput()" data-tooltip="Browse for folder">
                                <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"/>
                                </svg>
                                <span class="btn-text">Browse</span>
                            </button>
                        </div>
                    </div>
                </section>

                <section class="presets-section">
                    <h3 class="section-title">
                        <svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
                        </svg>
                        Quick Presets
                    </h3>
                    <div class="button-group">
                        <button class="preset-btn active" data-preset="recommended" data-tooltip="Balanced quality and speed">
                            <svg class="preset-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <circle cx="12" cy="12" r="3"/>
                            </svg>
                            <span class="preset-name">Recommended</span>
                            <span class="preset-desc">Balanced quality</span>
                        </button>
                        <button class="preset-btn" data-preset="fast" data-tooltip="Faster processing, more aggressive">
                            <svg class="preset-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
                            </svg>
                            <span class="preset-name">Extra Fast</span>
                            <span class="preset-desc">Quick processing</span>
                        </button>
                    </div>
                </section>

                <section class="settings-section">
                    <h3 class="section-title">
                        <svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 15a3 3 0 100-6 3 3 0 000 6z"/>
                            <path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z"/>
                        </svg>
                        Advanced Settings
                    </h3>
                    <div id="customSettings" class="settings-group visible">
                        <div class="settings-grid">
                            <div class="form-group">
                                <label class="form-label" data-tooltip="Lower values = more sensitive">
                                    <svg class="label-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M11 5L6 9H2v6h4l5 4V5z"/>
                                        <line x1="23" y1="9" x2="17" y2="15"/>
                                        <line x1="17" y1="9" x2="23" y2="15"/>
                                    </svg>
                                    Silence Threshold (dB)
                                </label>
                                <input type="number" id="silenceDb" value="-35" step="1" class="number-input">
                            </div>

                            <div class="form-group">
                                <label class="form-label" data-tooltip="Minimum silence duration to detect">
                                    <svg class="label-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="10"/>
                                        <polyline points="12 6 12 12 16 14"/>
                                    </svg>
                                    Min. Silence Duration (sec)
                                </label>
                                <input type="number" id="minSilenceDuration" value="0.5" step="0.1" min="0" class="number-input">
                            </div>

                            <div class="form-group">
                                <label class="form-label" data-tooltip="Keep this much audio before/after silence">
                                    <svg class="label-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 16V8a2 2 0 00-1-1.73l-7-4a2 2 0 00-2 0l-7 4A2 2 0 003 8v8a2 2 0 001 1.73l7 4a2 2 0 002 0l7-4A2 2 0 0021 16z"/>
                                    </svg>
                                    Padding Duration (sec)
                                </label>
                                <input type="number" id="paddingDuration" value="0.05" step="0.01" min="0" class="number-input">
                            </div>
                        </div>
                        
                        <div class="checkbox-group">
                            <label class="checkbox-label" data-tooltip="Normalize audio to YouTube standards">
                                <input type="checkbox" id="normalizeAudio" checked class="checkbox-input">
                                <span class="checkbox-text">
                                    <span class="checkbox-title">
                                        <svg class="checkbox-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M12 2v20M17 7H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6"/>
                                        </svg>
                                        Normalize Audio (YouTube Standard)
                                    </span>
                                    <span class="checkbox-desc">Adjust volume to -16 LUFS (MrBeast/YouTube level)</span>
                                </span>
                            </label>
                        </div>
                    </div>
                </section>

                <section class="action-section">
                    <button id="startBtn" onclick="startProcessing()" disabled class="start-btn" data-tooltip="Select input and output first">
                        <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polygon points="5 3 19 12 5 21 5 3"/>
                        </svg>
                        <span class="btn-text">Start Processing</span>
                    </button>
                </section>

                <section class="progress-section">
                    <div id="progress" class="progress-container">
                        <div class="progress-info">
                            <span class="progress-label">Processing status:</span>
                            <span id="status" class="progress-status">Preparing...</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-bar-fill" id="progressBar"></div>
                        </div>
                    </div>
                </section>

                <section class="log-section" id="logSection" style="display: none;">
                    <button class="log-toggle" onclick="toggleLogs()" id="logToggleBtn">
                        <span class="log-toggle-text">Show Processing Logs</span>
                        <span class="log-toggle-icon">▼</span>
                    </button>
                    <div id="logContainer" class="log-container-wrapper" style="display: none;">
                        <div id="log" class="log-container"></div>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <script>
        const { ipcRenderer } = require('electron');
        
        // Preset değerleri
        const presets = {
            recommended: {
                silenceDb: -35,
                minSilenceDuration: 0.5,
                paddingDuration: 0.05
            },
            fast: {
                silenceDb: -30,              
                minSilenceDuration: 0.4,     
                paddingDuration: 0.035       
            }
        };

        // Preset butonları için olay dinleyicileri
        document.querySelectorAll('.preset-btn').forEach(button => {
            button.addEventListener('click', () => {
                // Aktif butonu değiştir
                document.querySelectorAll('.preset-btn').forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');

                const preset = button.dataset.preset;
                const values = presets[preset];
                document.getElementById('silenceDb').value = values.silenceDb;
                document.getElementById('minSilenceDuration').value = values.minSilenceDuration;
                document.getElementById('paddingDuration').value = values.paddingDuration;
            });
        });

        function selectInput() {
            ipcRenderer.send('select-input');
        }

        function selectOutput() {
            ipcRenderer.send('select-output');
        }

        function startProcessing() {
            console.log('Start Processing clicked!');
            
            const params = {
                inputPath: document.getElementById('inputPath').value,
                outputPath: document.getElementById('outputPath').value,
                silenceDb: document.getElementById('silenceDb').value,
                minSilenceDuration: document.getElementById('minSilenceDuration').value,
                paddingDuration: document.getElementById('paddingDuration').value,
                normalizeAudio: document.getElementById('normalizeAudio').checked
            };

            console.log('Processing params:', params);

            document.getElementById('startBtn').disabled = true;
            document.getElementById('progress').style.display = 'block';
            document.getElementById('logSection').style.display = 'block';
            document.getElementById('status').textContent = 'Starting process...';

            // Progress bar'ı sıfırla
            document.getElementById('progressBar').style.width = '0%';
            
            // Log'u temizle ve kapat
            document.getElementById('log').innerHTML = '';
            document.getElementById('logContainer').style.display = 'none';
            document.getElementById('logToggleBtn').querySelector('.log-toggle-icon').textContent = '▼';
            document.getElementById('logToggleBtn').querySelector('.log-toggle-text').textContent = 'Show Processing Logs';

            console.log('Sending IPC message...');
            ipcRenderer.send('start-processing', params);
        }

        ipcRenderer.on('input-selected', (event, path) => {
            document.getElementById('inputPath').value = path;
            updateStartButton();
        });

        ipcRenderer.on('output-selected', (event, path) => {
            document.getElementById('outputPath').value = path;
            updateStartButton();
        });

        ipcRenderer.on('progress', (event, data) => {
            document.getElementById('status').textContent = data.status;
            document.getElementById('progressBar').style.width = `${data.percent}%`;
        });

        ipcRenderer.on('log', (event, message) => {
            const log = document.getElementById('log');
            log.innerHTML += message + '<br>';
            log.scrollTop = log.scrollHeight;
        });

        let currentOutputFile = null;

        ipcRenderer.on('completed', (event, result) => {
            document.getElementById('startBtn').disabled = false;
            document.getElementById('status').textContent = result.success ? 'Process completed!' : 'Error occurred!';
            if (result.success) {
                currentOutputFile = result.outputFile;
                
                // İşlem tamamlandığında progress bar'ı %100'e tamamla
                document.getElementById('progressBar').style.width = '100%';
                
                // Modal göster
                showCompletionModal();
                
                // 1 saniye sonra progress'i gizle
                setTimeout(() => {
                    document.getElementById('progress').style.display = 'none';
                    document.getElementById('progressBar').style.width = '0%';
                }, 1000);
            }
        });

        function showInFolder() {
            if (currentOutputFile) {
                ipcRenderer.send('show-in-folder', currentOutputFile);
            }
        }

        function updateStartButton() {
            const inputPath = document.getElementById('inputPath').value;
            const outputPath = document.getElementById('outputPath').value;
            const startBtn = document.getElementById('startBtn');
            startBtn.disabled = !(inputPath && outputPath);
            
            // Update tooltip
            if (inputPath && outputPath) {
                startBtn.setAttribute('data-tooltip', 'Start processing video');
            } else {
                startBtn.setAttribute('data-tooltip', 'Select input and output first');
            }
        }

        // Logs toggle
        function toggleLogs() {
            const logContainer = document.getElementById('logContainer');
            const toggleBtn = document.getElementById('logToggleBtn');
            const toggleIcon = toggleBtn.querySelector('.log-toggle-icon');
            
            if (logContainer.style.display === 'none') {
                logContainer.style.display = 'block';
                toggleIcon.textContent = '▲';
                toggleBtn.querySelector('.log-toggle-text').textContent = 'Hide Processing Logs';
            } else {
                logContainer.style.display = 'none';
                toggleIcon.textContent = '▼';
                toggleBtn.querySelector('.log-toggle-text').textContent = 'Show Processing Logs';
            }
        }

        // Modal functions
        function showCompletionModal() {
            const modal = document.getElementById('completionModal');
            modal.style.display = 'flex';
        }

        function closeModal() {
            const modal = document.getElementById('completionModal');
            modal.style.display = 'none';
        }

        function openFolderFromModal() {
            if (currentOutputFile) {
                ipcRenderer.send('show-in-folder', currentOutputFile);
            }
            closeModal();
        }

        // Sayfa yüklendiğinde son output path'i yükle
        window.addEventListener('DOMContentLoaded', () => {
            ipcRenderer.send('load-last-output');
        });
    </script>

    <!-- Completion Modal -->
    <div id="completionModal" class="modal">
        <div class="modal-backdrop" onclick="closeModal()"></div>
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"/>
                    <line x1="6" y1="6" x2="18" y2="18"/>
                </svg>
            </button>
            <div class="modal-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 11.08V12a10 10 0 11-5.93-9.14"/>
                    <polyline points="22 4 12 14.01 9 11.01"/>
                </svg>
            </div>
            <h2 class="modal-title">Processing Complete</h2>
            <p class="modal-text">Your video has been successfully processed and is ready to use.</p>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-primary" onclick="openFolderFromModal()">
                    <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"/>
                        <path d="M12 11v6M9 14l3 3 3-3"/>
                    </svg>
                    Show in Folder
                </button>
                <button class="modal-btn modal-btn-secondary" onclick="closeModal()">
                    <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                    Close
                </button>
            </div>
        </div>
    </div>

</body>
</html>
